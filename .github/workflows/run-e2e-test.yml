name: Run e2e tests

on: [push, pull_request]

jobs:
  run-e2e-tests:
      name: Run e2e tests
      runs-on: ubuntu-latest

      services:
        postgres:
          image: bitnami/postgresql
          ports:
            - 5432:5432
          env:
            POSTGRESQL_USERNAME: docker
            POSTGRESQL_PASSWORD: docker
            POSTGRESQL_DATABASE: findmed
      
      steps:
        - uses: actions/checkout@v3

        - uses: pnpm/action-setup@v4
          with:
            version: 10

        - run: pnpm install --frozen-lockfile

        - name: Generate prisma client for ci
          run: pnpm dlx prisma generate
        
        - run: pnpm run test:e2e
          env:
            JWT_PRIVATE_KEY: "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQzBQYzRFb2ozcHhZSmgKLzlBb1gyUGVZSG9HNHN1QlJ6VENWc0dRbUhVeXZDV2c0R3QyTUpudGNXNGtiK1dUSUk1WGNjVSs2RXlYSkh4ZQoxSlZzODNLMkhSYTdpQjVBZXJqNEZ1OGhtSVI1Y1JIWHltWmpLVnVuZStDdFl6RDQ0aDI2bklmL0dtTkYzRXZHCnZpZk43UFBBd1VwdW5mSkVKVVAvV3F5cXFtbno1Wlp6UzRTaDVNNU4wK21OMzQvL0QvYU1JUmtDVVMvVzM2S3YKcjNLV2tYcjRhQ3BNekVGVHpFOGZzMDl1aDhSUVlJajNKZmdpT1B1dFZKZ1phUmZac1o1MURzaDhkWjJDZlNIbwpMdmp1OCtEMmI0UnRLWERDYXZRUkJoY0taemE2V29VN1BrWXBSajdMTWZDcVUxcXVxdXh1UUZuejB2QnRyVGdiClBJSFdHVDlwQWdNQkFBRUNnZ0VBSzJNMVZLZzVmeXlzVmlyZVVObWxrTUpvblgrNnZVUUd6MEZURnh1Y0dycHYKMUdveGRDSCs2OG1DV2dNVm9IVVZ6cmIwWkZCSEg1c0kxVXNYTFVMdE9pbUdiMTQwNmhDZ3RoZlBPS2NlUEoyYgpUZmJLN3RQbDNFdFZxbWRXUXBNcjFPQVpYSzlkZGxPeGFnWWNUdFhiVjJzd0g3Q2x3UUczZktDM0w5NFY0ei9aCmJTeHR1YldtMGw0K2FVWDRJbmkraXYxSnh2Y1JTTldMY1Y5UUVRK3QvQ01JaXI0Rkp6TzhRNDdRR21aZGZqaXkKeVRRcGhoMER6bnVsSGlHaG5XNzZUcU9OdkJTWVRGbFg5TEdCWldFYmFFSEtIWHVPRG9oaUhndFlKQitQbllVUAp2T0RxbFROYXhKbFoweGlsSlJSdHZxdjBsZmhrbTgzSXQ3QU9ZZGs0Z1FLQmdRRG1PQnh1bW9uS28xZldYVDg4Cjk3eSs0aHJQVnYzSHNlMU5DRWErR0NPWklzc2dQaFBibEExbmVpUitldThwQUMyZU8zUmN1Q1BaZmR3VWYzMlgKd1RCZDQ1VHdGOEc2RkF0UGM3Z1NZdCt3UE1ZQS9heUdMSGxlNC8yZUhxdzBQY0drMDJqVEdXWmZNWTRvcUFVTQpHejQzZ05IR0c1MDBVejU3T1ZKVHpiSE14d0tCZ1FESWJQQldVWTVwMVB1TEJPKy84RFFMZHpRcWNheFQ1UGN5CndDalB2OXlBaWdzTWJpalNNUS9hem1hRGJreG4xTVdZSTI5YkhpbStUSThMTzAybGY1SUF2Snd0Q2svYm9JY0sKMDl0SHpHMTk4Y250NWNvWnJQSlozL1oxQ1BHN1pPVCtmZVJqSUFGZDZjelVSUDN5THNwam5JY3dvZjdIdC8zNwpvQld6TWRLQ1R3S0JnUURVeUJYWFVIUjgyMTVMSGlKZDJtZ1VVVzBRS0VvbGNWbHdNbThZTWIxdFE1QlV1NnVrCjdvRTVHOVp4SkhTNkE1VW1RN040SXlYWFZwRzhURjJyam42Q3VOOG16ZjViV3oxYzhRcTN5N1VOOGczY1NwcFQKNVBWRTlCcXNNNU5jTVp3eUdNZ3hISy9XMmptWGNEeENCVWdMQ3NCWWg1dFVDb0NjYWMyaThXSWRid0tCZ1FDRAp5OTlmWTlJYWxndXpwMU5oRER1dExuNEhTeWpmSWpuTURjREluSW9MbkxzWE9YbHVmd1RHQmVRem1WeDFDdDNFCjVjaGNTc0Y0ZWkrMld4RDhPNTl2REpoR3BmbE5tNG94L0k2OThCZ3dNY2R2d1NQZExuVlAxSTdrOXpTKzNlSVgKMkFGUGpjUllWVjUwVjhvR2IrNTNBbitENDRML0ltYktDTU04U3c3NjBRS0JnQ0dGOHp4Q1UxQ2JwVWxBMlovQgpiTzZqakRZWXZETTdiVDB6MG9hZkd5MXRNYTVTejJCM3RsaDVnelRmNlBjdTZIbzQyRzkxTmlZRW1RMUdhbk9BCkpaS1FKekNVTmJtNWhFWnE3YUZLQk1xUVpIaU5Yd0dnZVRwOUYyOHZUVTJINDZiVjNiS3VwUStWM2RDYStoOFcKamRCZkE5Um5xREw4NmIvRTlxWjZZbXdzCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K"
            JWT_PUBLIC_KEY: "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF0RDNPQktJOTZjV0NZZi9RS0Y5agozbUI2QnVMTGdVYzB3bGJCa0poMU1yd2xvT0JyZGpDWjdYRnVKRy9sa3lDT1YzSEZQdWhNbHlSOFh0U1ZiUE55CnRoMFd1NGdlUUhxNCtCYnZJWmlFZVhFUjE4cG1ZeWxicDN2Z3JXTXcrT0lkdXB5SC94cGpSZHhMeHI0bnplenoKd01GS2JwM3lSQ1ZELzFxc3FxcHA4K1dXYzB1RW9lVE9UZFBwamQrUC93LzJqQ0VaQWxFdjF0K2lyNjl5bHBGNgorR2dxVE14QlU4eFBIN05QYm9mRVVHQ0k5eVg0SWpqN3JWU1lHV2tYMmJHZWRRN0lmSFdkZ24waDZDNzQ3dlBnCjltK0ViU2x3d21yMEVRWVhDbWMydWxxRk96NUdLVVkreXpId3FsTmFycXJzYmtCWjg5THdiYTA0R3p5QjFoay8KYVFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg=="
            DATABASE_URL: "postgresql://docker:docker@localhost:5432/findmed?schema=public"